#!/bin/sh
#SBATCH --output=/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/psclogs/awa2/iter1/iter_4_VIT_g_test_residual_train_%j.out
pwd; hostname; date
CURRENT=`date +"%Y-%m-%d_%T"`
echo $CURRENT
slurm_output=/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/psclogs/awa2/iter1/iter_4_VIT_g_test_residual_train_$CURRENT.out
echo "Awa2"
source /ocean/projects/asc170022p/shg121/anaconda3/etc/profile.d/conda.sh
# conda activate python_3_7

conda activate python_3_7_rtx_6000

# Cum performance
# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/cum_performance.py --seed 5 --iterations 3 --dataset "awa2" --arch "ResNet50"
# Accuracy Mean (std dev): 0.8020060445085524 (0.020630386294513848)
# Auroc Mean (std dev): 0.5 (0.0)
# Recall Mean (std dev): 0.47476124428545763 (0.07132266920067765)
# Precision Mean (std dev): 0.5504892279481117 (0.06079103802348224)
# F1 Mean (std dev): 0.480090442337473 (0.07007004128942794)

# Training scripts
#---------------------------------
# # iter 1 
#---------------------------------
# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 150 --seed 5 --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 1 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/test_explainer_awa2.py --with_seed "y" --soft "y" --epochs 150 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 1 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output 


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 150 --epochs-residual 5 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 1 --expert-to-train "residual" --dataset "awa2" --cov 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50"  > $slurm_output




#---------------------------------
# # iter 2 
#---------------------------------
# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 2 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output

# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/test_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 2 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001 0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output 


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --epochs-residual 5 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 2 --expert-to-train "residual" --dataset "awa2" --cov 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001 0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50"  > $slurm_output



#---------------------------------
# # iter 3
# ---------------------------------
# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter2" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 3 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/test_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter2" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 3 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --epochs-residual 5 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter2" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 3 --expert-to-train "residual" --dataset "awa2" --cov 0.4 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  0.0001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output



#---------------------------------
# # iter 4
# ---------------------------------
# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter2" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter3" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 4 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 0.4 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  0.0001 0.001 --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/test_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter2" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter3" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 4 --expert-to-train "explainer" --dataset "awa2" --cov 0.4 0.4 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  0.0001 0.001  --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output


# python /ocean/projects/asc170022p/shg121/PhD/ICLR-2022/codebase/train_explainer_awa2.py --with_seed "y" --soft "y" --epochs 50 --epochs-residual 5 --seed 5 --checkpoint-model "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" "model_g_best_model.pth.tar" --checkpoint-residual "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" "model_residual_best_model.pth.tar" --prev_explainer_chk_pt_folder "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_150_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/iter1" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter2" "/ocean/projects/asc170022p/shg121/PhD/ICLR-2022/checkpoints/awa2/{soft_hard_filter}_concepts/seed_{seed}/explainer/ResNet50/lr_0.0001_epochs_50_temperature-lens_0.7_use-concepts-as-pi-input_True_input-size-pi_2048_cov_0.4_alpha_0.5_selection-threshold_0.5_lambda-lens_0.001_alpha-KD_0.9_temperature-KD_10.0_hidden-layers_1_layer_layer4_explainer_init_none/cov_0.4_lr_0.0001/iter3" --root-bb "lr_0.001_epochs_95" --checkpoint-bb "g_best_model_epoch_47.pth.tar" --iter 4 --expert-to-train "residual" --dataset "awa2" --cov 0.4 0.4 0.4 0.4 --bs 30 --dataset-folder "lr_0.001_epochs_95_ResNet50_layer4_adaptive_sgd_BCE" --lr 0.0001  0.0001  0.0001 0.001  --input-size-pi 2048 --temperature-lens 0.7 --lambda-lens 0.001 --alpha-KD 0.9 --temperature-KD 10 --hidden-nodes 10 --layer "layer4" --arch "ResNet50" > $slurm_output

